ifndef TARGET_DIR
	$(error TARGET_DIR is not set)
endif
.SUFFIXES: .c .o .h .mk
#################################################################################
#################### FUNCTIONS:
define getObjFileNameFromSrc
$(addprefix $(TARGET_LINK)/, $(patsubst %.c, %.o, $1))
endef

define printNiceMessage
@tput setaf 2
@echo $1
@tput sgr 0
endef
#################################################################################
#################### COMPILATION AUTOGENERATED VARIABLES:
SOURCES       = $(shell find "$(SRC_DIR)" -name "*.c";)
OBJECTS       = $(call getObjFileNameFromSrc,$(SOURCES))

TARGET_LINK   = $(notdir $(TARGET_DIR))
TARGET_DIRS   = $(sort $(dir $(OBJECTS)))

-include $(OBJECTS:.o=.mk)
#################################################################################
#################### STATIC PATTERN RULES:
$(TARGET_LINK)/%.o: %.c | $(TARGET_DIRS)
	$(COMPILE.c) -MM $< -MT $@ -MF $(@:.o=.mk)
	$(call printNiceMessage, "Dependency: $(@:.o=.mk) created.")
	$(COMPILE.c) -o $@ $<
	$(call printNiceMessage, "Object: $@ created.")
#################################################################################
#################### DIRECTORY GENERATION RULES:
$(TARGET_DIRS): %: | $(TARGET_LINK)
	mkdir -p $@

$(TARGET_LINK):
	ln -s $(TARGET_DIR) $@
