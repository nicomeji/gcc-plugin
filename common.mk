.SUFFIXES: .c .o .h .mk
#################################################################################
#################### FUNCTIONS:
define getDependsFileNameFromSrc
$(addprefix $(TARGET_LINK)/, $(patsubst %.c, %.mk, $1))
endef

define getObjFileNameFromSrc
$(addprefix $(TARGET_LINK)/, $(patsubst %.c, %.o, $1))
endef

define printNiceMessage
@tput setaf 2
@echo $1
@tput sgr 0
endef
#################################################################################
#################### COMPILATION AUTOGENERATED VARIABLES:
SOURCES       = $(shell find "$(SRC_DIR)" -name "*.c";)
OBJECTS       = $(call getObjFileNameFromSrc,$(SOURCES))
DEPENDENCIES  = $(call getDependsFileNameFromSrc,$(SOURCES))

TARGET_LINK   = $(notdir $(TARGET_DIR))
$(shell echo "$(TARGET_DIR)")
$(shell ln -s $(TARGET_DIR) $(TARGET_LINK))
TARGET_DIRS   = $(sort $(dir $(OBJECTS)))
$(foreach DIR,$(TARGET_DIRS),$(shell mkdir -p $(DIR)))

-include $(DEPENDENCIES)
#################################################################################
#################### STATIC PATTERN RULES:
BASIC.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH)
LINK.c  = $(BASIC.c) $(LDFLAGS)

$(TARGET_LINK)/%.o: %.c
	$(BASIC.c) -c -o $@ $<
	$(call printNiceMessage, "Object: $@ created.")

$(TARGET_LINK)/%.mk: %.c
	$(BASIC.c) -MM $< -MT $(call getObjFileNameFromSrc, $<) -MF $@
	$(call printNiceMessage, "Dependency: $@ created.")
